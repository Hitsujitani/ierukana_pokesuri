<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ポケスリ全部いえるかな？</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --blue-light:#5aa9ff;
      --red-light:#ff7f7f;
      --text-white:#ffffff;
      --disabled-bg:#e0e0e0;
      --disabled-text:#9e9e9e;
      --card-bg:#ffffff;
      --panel-bg:rgba(255,255,255,.70);
    }
    html,body{height:100%;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic UI","Meiryo",Arial,sans-serif;
      color:#111; text-align:left;
      background-image:url("./greenglass.jpg");
      background-size:cover; background-position:center; background-repeat:no-repeat;
      background-color:#8fdc6b;
    }
    /* タイトルのみ中央 */
    h1{ text-align:center; margin:18px 0 10px; }

    /* 入力行 & ステータス */
    .input-row{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; margin:0 auto; width:min(1100px,92vw);}
    .hint{ font-size:.85em; color:#333; }
    input{ font-size:16px; padding:8px 10px; border-radius:6px; border:1px solid #cfd8dc; background:#fff; }
    button{ font-size:16px; padding:8px 14px; cursor:pointer; border:none; border-radius:6px; }
    .btn-answer{ background:var(--blue-light); color:var(--text-white);}
    .btn-start{  background:var(--red-light);  color:var(--text-white);}
    .btn-share{  background:var(--blue-light); color:var(--text-white);}
    button:disabled, input:disabled{ background:var(--disabled-bg)!important; color:var(--disabled-text)!important; cursor:not-allowed; }

    .status-row{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; margin:8px auto 0; width:min(1100px,92vw);}
    .status-left{ display:flex; align-items:center; gap:12px; flex-wrap:wrap;}
    .status-right{ margin-left:auto;}

    /* スクロールボックス（背景上で可読性UP） */
    #scrollContainer{
      max-height:520px; overflow:auto;
      border:1px solid #cfd8dc;
      margin:18px auto; width:min(1100px,92vw);
      background:var(--panel-bg);
      border-radius:10px; padding:14px;
      box-shadow:0 6px 16px rgba(0,0,0,.08);
    }
    /* たくさん表示できるようコンパクト */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(120px,1fr));
  grid-auto-rows:minmax(24px,auto);
  grid-auto-flow:row;
  gap:6px;
}
.grid .cell{
  background:var(--card-bg);
  border:1px solid #e3e7ea;
  border-radius:6px;
  padding:4px 6px;
  font-size:13px; /* 小さめフォント */
  font-weight:600;
  line-height:1.2;
  box-shadow:0 1px 4px rgba(0,0,0,.05);
  min-height:1.8em;
}


    /* フッター */
    .footer{ width:min(1100px,92vw); margin:10px auto 18px; font-size:12px; color:#333; text-align:right; line-height:1.6;}
    .footer a{ color:#0b69ff; text-decoration:none; }
    .footer a:hover{ text-decoration:underline; }

    /* モーダル */
    .modal-overlay{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); align-items:center; justify-content:center; z-index:9999;}
    .modal{ background:#fff; padding:20px; border-radius:10px; width:min(520px,92vw); box-shadow:0 12px 30px rgba(0,0,0,.25);}
    .modal h2{ margin:.2em 0 .6em; text-align:left;}
    .modal .actions{ display:flex; justify-content:flex-end; gap:8px; margin-top:14px;}
  </style>
</head>
<body>
  <h1>ポケスリ全部いえるかな？</h1>

  <div class="input-row">
    <p class="hint">ポケモンの名前を入力してください（ひらがなOK）</p>
    <strong id="progressText">0／0</strong>
  </div>

  <div class="status-row">
    <div class="status-left">
      <input type="text" id="pokemonInput" placeholder="ポケモンの名前を入力" disabled />
      <button id="answerBtn" class="btn-answer" disabled>回答</button>
      <button id="startBtn" class="btn-start">開始</button>
      <span id="timer">00:00:00</span>
    </div>
    <div class="status-right">
      <button id="shareBtnMain" class="btn-share">結果をXで共有</button>
    </div>
  </div>

  <div id="scrollContainer">
    <div class="grid" id="pokemonList"></div>
  </div>

 <div class="footer">
  <div>Ver. 3.0.0</div>
  <div>同一図鑑番号のリージョンフォームやイベント限定ポケモンは区別しません</div>
  <div>
    作成者：羊谷ランプ 
    <a href="https://x.com/fuck_capslock" target="_blank" rel="noopener noreferrer">
      @fuck_capslock
    </a>
  </div>
  <div>Inspired by ポケモン全部言えるかな？ゲーム</div>
</div>
  
  </div>

  <!-- 全問正解モーダル -->
  <div id="completeOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="completeTitle">
    <div class="modal">
      <h2 id="completeTitle">全問正解おめでとう！あなたは立派な廃人プレイヤーです！こんなゲームやってないで、さっさと寝ましょう！</h2>
      <div class="actions">
        <button id="completeShareBtn" class="btn-share">結果をXで共有</button>
        <button id="completeOk" class="btn-start">OK</button>
      </div>
    </div>
  </div>

  <script>
    /* ========= 文字正規化（ひらがな完全対応・表記ゆれ吸収） =========
       1) NFKC正規化（半角カナ・濁点等を結合）/ 2) ()→（）
       3) 半角長音 ｰ → 全角長音 ー / 4) 全ての空白（含 全角）除去
       5) ひらがな → カタカナ / 6) 連続長音の正規化
    */
    const RE_ALL_SPACES = /[\s\u3000]+/g;        // 半角/全角スペース
    const RE_HIRA = /[ぁ-ん]/g;
    const RE_HW_CHOON = /\uFF70/g;               // ｰ
    const RE_MULTI_CHOON = /ー{2,}/g;            // ーー → ー

    function toKatakanaFromHiragana(str){
      return str.replace(RE_HIRA, ch => String.fromCharCode(ch.charCodeAt(0) + 0x60));
    }
    function canon(s){
      if(!s) return "";
      let x = s.normalize('NFKC')
               .replace(/[()]/g, m => m === '(' ? '（' : '）')
               .replace(RE_HW_CHOON, 'ー')
               .replace(RE_ALL_SPACES, '');     // 空白は無視
      x = toKatakanaFromHiragana(x);
      x = x.replace(RE_MULTI_CHOON, 'ー');
      return x;
    }

    /* ====== データ（5件ごとに改行／除外6種は最初から含めない／ストリンダー表記統一）====== */
    const pokemonTableRaw = [
      "フシギダネ", "フシギソウ", "フシギバナ", "ヒトカゲ", "リザード",
      "リザードン", "ゼニガメ", "カメール", "カメックス", "キャタピー",
      "トランセル", "バタフリー", "コラッタ", "ラッタ", "アーボ",
      "アーボック", "ピカチュウ", "ライチュウ", "ピッピ",
      "ピクシー", "ロコン", "キュウコン", "プリン", "プクリン",
      "ディグダ", "ダグトリオ", "ニャース", "ペルシアン", "コダック",
      "ゴルダック", "マンキー", "オコリザル", "ガーディ", "ウインディ",
      "マダツボミ", "ウツドン", "ウツボット", "イシツブテ", "ゴローン",
      "ゴローニャ", "ヤドン", "ヤドラン", "コイル", "レアコイル",
      "カモネギ", "ドードー", "ドードリオ", "ゴース", "ゴースト",
      "ゲンガー", "イワーク", "カラカラ", "ガラガラ", "ラッキー",
      "ガルーラ", "バリヤード", "カイロス", "メタモン", "イーブイ",
      "シャワーズ", "サンダース", "ブースター", "ミニリュウ", "ハクリュー",
      "カイリュー", "チコリータ", "ベイリーフ", "メガニウム", "ヒノアラシ",
      "マグマラシ", "バクフーン", "ワニノコ", "アリゲイツ", "オーダイル",
      "ピチュー", "ピィ", "ププリン", "トゲピー", "トゲチック",
      "ネイティ", "ネイティオ", "メリープ", "モココ", "デンリュウ",
      "ウソッキー", "ウパー", "ヌオー", "エーフィ", "ブラッキー",
      "ヤミカラス", "ヤドキング", "ソーナンス", "ハガネール", "ヘラクロス",
      "ニューラ", "デリバード", "デルビル", "ヘルガー", "ハピナス",
      "ライコウ", "エンテイ", "スイクン", "ヨーギラス", "サナギラス",
      "バンギラス", "キモリ", "ジュプトル", "ジュカイン", "アチャモ",
      "ワカシャモ", "バシャーモ", "ミズゴロウ", "ヌマクロー", "ラグラージ",
      "ラルトス", "キルリア", "サーナイト", "ナマケロ", "ヤルキモノ",
      "ケッキング", "ヤミラミ", "クチート", "ココドラ", "コドラ",
      "ボスゴドラ", "プラスル", "マイナン", "ゴクリン", "マルノーム",
      "ナックラー", "ビブラーバ", "フライゴン",
      "チルット", "チルタリス", "カゲボウズ", "ジュペッタ", "アブソル",
      "ソーナノ", "タマザラシ", "トドグラー", "トドゼルガ", 
      "タツベイ", "コモルー", "ボーマンダ", "コリンク",
      "ルクシオ", "レントラー", "フワンテ", "フワライド", "ドンカラス",
      "ウソハチ", "マネネ", "ピンプク", "リオル", "ルカリオ",
      "グレッグル", "ドクロッグ", "ユキカブリ", "ユキノオー", "マニューラ",
      "ジバコイル", "トゲキッス", "リーフィア", "グレイシア", "エルレイド",
      "クレセリア", "ダークライ", "ムンナ", "ムシャーナ", 
      "イシズマイ", "イワパレス", "ワシボン",
      "ウォーグル", "ニンフィア", "デデンネ", "バケッチャ", "パンプジン", "アゴジムシ", "デンヂムシ",
      "クワガノン", "ヌイコグマ", "キテルグマ", "キュワワー", "ミミッキュ",
      "ウッウ", "エレズン", "ストリンダー", "ニャオハ", "ニャローテ",
      "マスカーニャ", "ホゲータ", "アチゲータ", "ラウドボーン", "クワッス",
      "ウェルカモ", "ウェーニバル", "パモ", "パモット", "パーモット",
      "ドオー"
    ];
   const pokemonNumbers = [
  "001", "002", "003", "004", "005",
  "006", "007", "008", "009", "010",
  "011", "012", "019", "020", "023",
  "024", "025", "026", "035", "036",
  "037", "038", "039", "040", "050",
  "051", "052", "053", "054", "055",
  "056", "057", "058", "059", "069",
  "070", "071", "074", "075", "076",
  "079", "080", "081", "082", "083",
  "084", "085", "092", "093", "094",
  "095", "104", "105", "113", "115",
  "122", "127", "132", "133", "134",
  "135", "136", "147", "148", "149",
  "152", "153", "154", "155", "156",
  "157", "158", "159", "160", "172",
  "173", "174", "175", "176", "177",
  "178", "179", "180", "181", "185",
  "194", "195", "196", "197", "198",
  "199", "202", "208", "214", "215",
  "225", "228", "229", "242", "243",
  "244", "245", "246", "247", "248",
  "252", "253", "254", "255", "256",
  "257", "258", "259", "260", "280",
  "281", "282", "287", "288", "289",
  "302", "303", "304", "305", "306",
  "311", "312", "316", "317", 
  "328", "329", "330", "333",
  "334", "353", "354", "359", "360",
  "363", "364", "365", 
  "371", "372", "372", "403", "404",
  "405", "425", "426", "430", "438",
  "439", "440", "447", "448", "453",
  "454", "459", "460", "461", "462",
  "468", "470", "471", "475", "488",
  "491", "517", "518", 
  "557", "558", "627", "628",
  "700", "702", "710", "711", "736", "737", "738",
  "759", "760", "764", "778", "845",
  "848", "849", "906", "907", "908",
  "909", "910", "911", "912", "913",
  "914", "921", "922", "923", "980"
];


    /* ====== 状態 ====== */
    let correctFlags = Array(pokemonTableRaw.length).fill(false);
    let solvedCount = 0;
    const totalCount = pokemonTableRaw.length;

    const progressText = document.getElementById("progressText");
    const list = document.getElementById("pokemonList");
    const inputElem = document.getElementById("pokemonInput");
    const answerBtn = document.getElementById("answerBtn");
    const startBtn = document.getElementById("startBtn");
    const timerElem = document.getElementById("timer");
    const shareBtnMain = document.getElementById("shareBtnMain");

    const overlay = document.getElementById("completeOverlay");
    const completeShareBtn = document.getElementById("completeShareBtn");
    const completeOk = document.getElementById("completeOk");

    /* ====== タイマー ====== */
    let startTime = null, timerId = null, running = false;
    function formatTime(ms){
      const t=Math.floor(ms/1000);
      const h=String(Math.floor(t/3600)).padStart(2,"0");
      const m=String(Math.floor((t%3600)/60)).padStart(2,"0");
      const s=String(t%60).padStart(2,"0");
      return `${h}:${m}:${s}`;
    }
    function startTimer(){
      if(running) return;
      startTime = Date.now();
      timerId = setInterval(()=>{ timerElem.textContent = formatTime(Date.now()-startTime); }, 200);
      running = true;
      inputElem.disabled = false;
      answerBtn.disabled = false;
      inputElem.focus();
    }
    function stopTimer(){
      if(!running) return;
      clearInterval(timerId); timerId=null; running=false;
    }

    /* ====== 進捗 ====== */
    function updateProgress(){ progressText.textContent = `${solvedCount}／${totalCount}`; }
    updateProgress();

    /* ====== 一覧描画（初期は空白表示：「番号.　」） ====== */
    function renderList(){
      const frag = document.createDocumentFragment();
      for(let i=0;i<pokemonNumbers.length;i++){
        const div = document.createElement("div");
        div.className = "cell";
        div.id = `poke-${i}`;
        div.textContent = `${pokemonNumbers[i]}.　`; // 全角スペースで空白
        frag.appendChild(div);
      }
      list.innerHTML = "";
      list.appendChild(frag);
    }
    renderList();

    /* ====== 正解側の正規化を事前に計算（一致精度と速度を向上） ====== */
    const answersCanonical = pokemonTableRaw.map(canon);

    /* ====== 回答処理（Enter確定 or ボタン） ====== */
    function checkPokemon(){
      if(inputElem.disabled) return;
      const k = canon(inputElem.value);
      if(!k) return;

      const idx = answersCanonical.findIndex((ac, i) => !correctFlags[i] && ac === k);
      if (idx !== -1){
        const cells = list.querySelectorAll(".cell");
        correctFlags[idx] = true;
        cells[idx].textContent = `${pokemonNumbers[idx]}. ${pokemonTableRaw[idx]}`;
        cells[idx].scrollIntoView({behavior:"smooth", block:"center"});
        solvedCount++; updateProgress();

        if(solvedCount === totalCount){
          stopTimer();
          overlay.style.display = "flex";
        }
      }

      inputElem.value = "";
      inputElem.focus();
    }

    /* ====== イベント ====== */
    inputElem.addEventListener("keydown", (e)=>{ if(e.key==="Enter" && !e.isComposing){ checkPokemon(); } });
    answerBtn.addEventListener("click", checkPokemon);
    startBtn.addEventListener("click", startTimer);

    /* ====== 共有 ====== */
shareBtnMain.addEventListener("click", ()=>{
  const text = `ポケモンスリープ なにも見ずに全匹いえるかな？ あなたは${timerElem.textContent}で${totalCount}匹中${solvedCount}覚えていたよ！ - #ポケスリ全部いえるかな https://hitsujitani.github.io/ierukana_pokesuri/`;
  const url = "https://x.com/intent/tweet?text=" + encodeURIComponent(text);
  window.open(url, "_blank");
});

/* ====== 完了モーダル ====== */
completeShareBtn.addEventListener("click", ()=>{
  const text = `ポケモンスリープ なにも見ずに全匹いえるかな？ あなたは${timerElem.textContent}で${totalCount}匹中全問正解しました！クリアおめでとう！遊んでないで早く寝よう！ - #ポケスリ全部いえるかな https://hitsujitani.github.io/ierukana_pokesuri/`;
  const url = "https://x.com/intent/tweet?text=" + encodeURIComponent(text);
  window.open(url, "_blank");
});

    completeOk.addEventListener("click", ()=>{ overlay.style.display="none"; });
  </script>
</body>
</html>
